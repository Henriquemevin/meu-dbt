version: 2

models:
  - name: funnel
    description: "Funil de marketing e vendas"
    columns:
      - name: date
        label: "Data"
        description: "Data do evento"
      - name: leads
        label: "Leads"
        description: "Número de leads gerados"
      - name: opportunities
        label: "Oportunidades"
        description: "Oportunidades abertas"
      - name: spend
        label: "Investimento (R$)"
        description: "Valor investido em anúncios"
      - name: expected_revenue
        label: "Receita Esperada"
        description: "Receita ponderada pela probabilidade"

metrics:
  - name: total_spend
    label: "Investimento Total"
    type: sum
    sql: spend

  - name: total_leads
    label: "Total de Leads"
    type: sum
    sql: leads

  - name: total_opportunities
    label: "Total de Oportunidades"
    type: sum
    sql: opportunities

  - name: total_expected_revenue
    label: "Receita Esperada"
    type: sum
    sql: expected_revenue

  - name: cpl
    label: "Custo por Lead (CPL)"
    type: expression
    sql: "total_spend / NULLIF(total_leads,0)"
